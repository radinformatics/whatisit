{% extends "main/base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load humanize %}

{% block css %}
<link href="{% static "css/bootstrap.datatables.css"%}" media="screen" rel="stylesheet" type="text/css" />
<!--https://cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css-->
{% endblock %}

{% block content %}
{% include 'main/message.html' %}

{% if labels %}
<div class="row">

    <div style="padding-top:50px" class="col-md-12">
        <h2>Select from Existing</h2>

                   <table id="labels" class="table table-striped table-bordered" cellspacing="0" width="100%">
                       <thead class="thead-inverse">
                           <tr>
                               <th>Label Name</th>
                               <th>Options</th>
                               <th></th>
                           </tr>
                       </thead>

                           <form method="POST">
                               {% csrf_token %}
 
                               <tbody>
                               {% for label in labels %}
                                   <tr>
                                       <td>{{ label.name }}</td>
                                       <td>{{ label.option }}</td> 
                                       <td><a class="add_existing" data-url="{% url 'create_label' collection.id label.id %}"><button class="btn btn-success btn-sm">Add Label</button></a>
                                   </tr>
                                {% endfor %}
                               </tbody>
                           </form>
                    </table>
                </div>
    </div>
</div>
{% endif %}


<div class="row">

    <div class="col-md-12 card">
        <br>
        <h2>Add New Label</h2>

        <!-- Here the user has the option to add an annotator -->
        <form action="{% url 'create_label' collection.id %}" method="POST">

            {% csrf_token %}

            <div class="text-xs-center">
                <button type="submit" class="btn btn-primary">Add</button>
            </div>
        </form>
    </div>
</div>



{% endblock %}
{% block scripts %}
<script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js"></script>
<script>
$(document).ready(function(){

   // Create label with ajax, success will disabled/change text of button
   $('.add_existing').click(function(){
       var url = $(this).attr('data-url')
       var button = this;
   
        $.ajax({
            url : url, // the endpoint
            type : "POST", // http method
            
            // handle a successful response
            success : function(json) {
                console.log(json); // log the returned json to the console
                console.log("success"); // another sanity check
                $(button).attr('disabled','disabled')
                $(button).removeClass('btn-success',true)
                $(button).addClass('btn-info',true)
            },

            // handle a non-successful response
            error : function(xhr,errmsg,err) {
                $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                    " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
                     console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
         });

   })

        //var annotations = JSON.stringify($("#update_annotation").serializeArray())

})
</script>
{% endblock %}
